{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../user.service\";\nimport * as i4 from \"./edit-profile/edit-profile.component\";\nimport * as i5 from \"./funds/funds.component\";\nimport * as i6 from \"./order-status/order-status.component\";\n\nfunction UserComponent_div_25_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\", 11)(2, \"div\", 19)(3, \"strong\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(5, \"br\");\n    i0.ɵɵelementStart(6, \"div\", 14);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 19)(9, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function UserComponent_div_25_div_14_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const item_r4 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext(2);\n      return ctx_r6.removeFromCart(item_r4);\n    });\n    i0.ɵɵtext(10, \"Remove\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 21);\n    i0.ɵɵelement(12, \"input\", 22, 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 21)(15, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function UserComponent_div_25_div_14_Template_button_click_15_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r7);\n      const item_r4 = restoredCtx.$implicit;\n\n      const _r5 = i0.ɵɵreference(13);\n\n      const ctx_r8 = i0.ɵɵnextContext(2);\n      return ctx_r8.updateFromCart(item_r4[0], _r5.value);\n    });\n    i0.ɵɵtext(16, \"Update\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"div\", 14)(18, \"p\");\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(20, \"hr\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const item_r4 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(item_r4[0]);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"$ \", item_r4[1][1], \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵpropertyInterpolate(\"value\", item_r4[1][0]);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate((item_r4[1][1] * item_r4[1][0]).toPrecision(2));\n  }\n}\n\nfunction UserComponent_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"h3\");\n    i0.ɵɵtext(2, \"Cart\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11)(4, \"div\", 12)(5, \"strong\");\n    i0.ɵɵtext(6, \"Item\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 13)(8, \"strong\");\n    i0.ɵɵtext(9, \"Quantity\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"div\", 14)(11, \"strong\");\n    i0.ɵɵtext(12, \"Total($)\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(13, \"hr\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(14, UserComponent_div_25_div_14_Template, 21, 4, \"div\", 15);\n    i0.ɵɵelementStart(15, \"div\", 11)(16, \"div\", 12)(17, \"strong\");\n    i0.ɵɵtext(18, \"Total\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"div\", 13)(20, \"strong\");\n    i0.ɵɵtext(21);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(22, \"div\", 14)(23, \"strong\");\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(25, \"hr\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 16)(27, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function UserComponent_div_25_Template_button_click_27_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.buyOrder();\n    });\n    i0.ɵɵtext(28, \"Buy Now\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(14);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.localCart);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(ctx_r0.totalQty);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"$ \", ctx_r0.cartTotal, \"\");\n  }\n}\n\nfunction UserComponent_app_edit_profile_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-edit-profile\");\n  }\n}\n\nfunction UserComponent_div_27_app_funds_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-funds\");\n  }\n}\n\nfunction UserComponent_div_27_div_2_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"div\", 28);\n    i0.ɵɵelement(2, \"img\", 29);\n    i0.ɵɵelementStart(3, \"div\", 30)(4, \"h5\", 31);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 32);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function UserComponent_div_27_div_2_div_4_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r17);\n      const item_r15 = restoredCtx.$implicit;\n      const ctx_r16 = i0.ɵɵnextContext(3);\n      return ctx_r16.addToCart(item_r15.id, item_r15.price);\n    });\n    i0.ɵɵtext(9, \"Add\");\n    i0.ɵɵelementEnd()()()();\n  }\n\n  if (rf & 2) {\n    const item_r15 = ctx.$implicit;\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(item_r15.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(item_r15.price);\n  }\n}\n\nfunction UserComponent_div_27_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26)(1, \"h3\");\n    i0.ɵɵtext(2, \"Items\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 27);\n    i0.ɵɵtemplate(4, UserComponent_div_27_div_2_div_4_Template, 10, 2, \"div\", 15);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r12 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r12.items);\n  }\n}\n\nfunction UserComponent_div_27_app_order_status_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-order-status\");\n  }\n}\n\nfunction UserComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10);\n    i0.ɵɵtemplate(1, UserComponent_div_27_app_funds_1_Template, 1, 0, \"app-funds\", 9);\n    i0.ɵɵtemplate(2, UserComponent_div_27_div_2_Template, 5, 1, \"div\", 25);\n    i0.ɵɵtemplate(3, UserComponent_div_27_app_order_status_3_Template, 1, 0, \"app-order-status\", 9);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showFunds);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showHome);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.showOrder);\n  }\n}\n\nexport let UserComponent = /*#__PURE__*/(() => {\n  class UserComponent {\n    constructor(router, locationStrategy, userService) {\n      this.router = router;\n      this.locationStrategy = locationStrategy;\n      this.userService = userService;\n      this.items = [];\n      this.showCart = false;\n      this.showEdit = false;\n      this.localCart = [];\n      this.cart = [];\n      this.currentUser = sessionStorage.getItem(\"userName\");\n      this.showFunds = false;\n      this.showHome = true;\n      this.showOrder = false;\n      this.totalQty = 0;\n      this.cartTotal = 0;\n      this.curr_funds = 0;\n      this.itemSelected = new Map();\n      this.preventBackButton();\n      userService.getProducts().subscribe(result => {\n        this.items = result.data;\n        console.log(result.data);\n        console.log(this.items);\n      });\n\n      if (this.currentUser != null) {\n        userService.getUserByUsername(this.currentUser).subscribe(result => {\n          console.log(result.user[0].cart);\n          let user_details = result['user'][0];\n          this.curr_funds = user_details['funds'];\n          this.cart = result.user[0].cart;\n\n          for (let i = 0; i < this.cart.length; i++) {\n            this.itemSelected.set(this.cart[i].id, [this.cart[i].quantity, (this.cart[i].total / this.cart[i].quantity).toPrecision(2)]);\n          }\n\n          this.localCart = Array.from(this.itemSelected);\n          this.cartTotalCal();\n        });\n      }\n    }\n\n    ngOnInit() {}\n\n    preventBackButton() {\n      history.pushState(null, \"\", location.href);\n      this.locationStrategy.onPopState(() => {\n        history.pushState(null, \"\", location.href);\n      });\n    }\n\n    logout_user() {\n      let logout = confirm(\"Are you sure you want to log out?\");\n\n      if (logout) {\n        sessionStorage.clear();\n        this.router.navigate(['']);\n      }\n    }\n\n    addToCart(item, itmPrice) {\n      if (this.itemSelected.has(item)) {\n        this.itemSelected.set(item, [this.itemSelected.get(item)[0] + 1, itmPrice.toPrecision(2)]);\n      } else {\n        this.itemSelected.set(item, [1, itmPrice.toPrecision(2)]);\n      }\n\n      this.localCart = Array.from(this.itemSelected);\n      console.log(\"LOCAL CART \" + this.localCart);\n      this.updateCartDB(item); //this.cartTotalCal();\n    }\n\n    showCartBtn() {\n      this.showCart = true;\n      this.showEdit = false;\n    }\n\n    showEditBtn() {\n      this.showHome = false;\n      this.showCart = false;\n      this.showFunds = false;\n      this.showEdit = true;\n      this.showOrder = false;\n    }\n\n    showFundBtn() {\n      this.showHome = false;\n      this.showCart = false;\n      this.showEdit = false;\n      this.showFunds = true;\n      this.showOrder = false;\n    }\n\n    homeBtn() {\n      this.showCart = false;\n      this.showEdit = false;\n      this.showFunds = false;\n      this.showHome = true;\n      this.showOrder = false;\n    }\n\n    showOrderBtn() {\n      this.showCart = false;\n      this.showEdit = false;\n      this.showFunds = false;\n      this.showHome = false;\n      this.showOrder = true;\n    }\n\n    removeFromCart(item) {\n      let index = this.localCart.indexOf(item);\n      this.localCart.splice(index, 1);\n      this.itemSelected.delete(item[0]);\n      this.updateCartDB(item[0]);\n    }\n\n    updateFromCart(item, qty) {\n      if (parseInt(qty) > 0) {\n        if (this.itemSelected.has(item)) {\n          this.itemSelected.set(item, [parseInt(qty), this.itemSelected.get(item)[1]]);\n        }\n\n        this.localCart = Array.from(this.itemSelected);\n        this.updateCartDB(item);\n      } else {\n        alert(\"Invalid input\");\n      }\n    }\n\n    updateCartDB(item) {\n      this.cart = [];\n\n      for (let i = 0; i < this.localCart.length; i++) {\n        let obj = {\n          id: this.localCart[i][0],\n          quantity: this.localCart[i][1][0],\n          total: this.localCart[i][1][0] * this.localCart[i][1][1]\n        };\n        this.cart.push(obj);\n      }\n\n      let userCart = {\n        userName: sessionStorage.getItem('userName'),\n        cart: this.cart\n      };\n      this.cartTotalCal();\n      this.userService.updateProfile(userCart);\n    }\n\n    cartTotalCal() {\n      this.totalQty = 0;\n      this.cartTotal = 0;\n\n      for (let [key, value] of this.itemSelected) {\n        this.totalQty += value[0];\n        var itemTotal = parseFloat((value[0] * value[1]).toPrecision(2));\n        this.cartTotal += itemTotal;\n      }\n    }\n\n    fundsUpdate() {\n      if (this.currentUser != null) {\n        this.userService.getUserByUsername(this.currentUser).subscribe(result => {\n          let user_details = result['user'][0];\n          this.curr_funds = user_details['funds'];\n          console.log(this.curr_funds);\n        });\n      }\n    }\n\n    buyOrder() {\n      console.log(\"check buy\");\n      this.fundsUpdate();\n\n      if (this.cartTotal <= 0) {\n        alert(\"Please add items to the cart\");\n      } else if (this.curr_funds < this.cartTotal) {\n        var msg = this.currentUser + \"  have Insufficient Funds  $\" + this.curr_funds + \".Please add funds to your account\";\n        alert(msg);\n      } else {\n        let today = new Date();\n        let dd = String(today.getDate()).padStart(2, '0');\n        let mm = String(today.getMonth() + 1).padStart(2, '0');\n        let yyyy = today.getFullYear();\n        let funds = this.cartTotal * -1;\n        let date = mm + '/' + dd + '/' + yyyy;\n        let order = {\n          id: this.makeOrderId(),\n          userName: sessionStorage.getItem('userName'),\n          status: \"Pending\",\n          cart: this.cart,\n          total: this.cartTotal,\n          date: date\n        };\n        console.log(\"Clicked\");\n        console.log(order);\n        this.userService.createOrder(order).subscribe(result => {\n          console.log(result);\n          this.totalQty = 0;\n          this.cartTotal = 0;\n          this.cart = [];\n          this.localCart = [];\n          this.itemSelected = new Map();\n          let userCart = {\n            userName: sessionStorage.getItem('userName'),\n            cart: this.cart\n          };\n          this.userService.updateProfile(userCart);\n          let funds_info = {\n            userName: sessionStorage.getItem('userName'),\n            funds: funds\n          };\n          this.userService.addFunds(funds_info).subscribe(res => {});\n        });\n      }\n    }\n\n    makeOrderId() {\n      let min = Math.ceil(100000000000);\n      let max = Math.floor(999999999999);\n      let num = Math.floor(Math.random() * (max - min) + min);\n      return `${num}`;\n    }\n\n  }\n\n  UserComponent.ɵfac = function UserComponent_Factory(t) {\n    return new (t || UserComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.LocationStrategy), i0.ɵɵdirectiveInject(i3.UserService));\n  };\n\n  UserComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: UserComponent,\n    selectors: [[\"app-user\"]],\n    decls: 28,\n    vars: 4,\n    consts: [[1, \"navbar\", \"navbar-expand-lg\", \"navbar-light\", \"bg-light\"], [1, \"container-fluid\"], [1, \"navbar-brand\"], [\"id\", \"navbarSupportedContent\", 1, \"collapse\", \"navbar-collapse\"], [1, \"navbar-nav\", \"me-auto\", \"mb-2\", \"mb-lg-0\"], [1, \"nav-item\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-primary\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"click\"], [\"class\", \"container\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"container\"], [1, \"row\"], [1, \"col-sm-5\"], [1, \"col-sm-6\"], [1, \"col-sm-1\"], [\"class\", \"name\", 4, \"ngFor\", \"ngForOf\"], [1, \"col-md-12\", \"text-center\"], [\"type\", \"button\", 1, \"btn\", \"btn-primary\", \"active\", \"mb-8\", 3, \"click\"], [1, \"name\"], [1, \"col-sm-2\"], [\"id\", \"removeBtn\", \"type\", \"button\", 1, \"btn\", \"btn-outline-danger\", 3, \"click\"], [1, \"col-sm-3\"], [\"type\", \"number\", \"id\", \"orderedQuantity\", \"step\", \"1\", \"min\", \"1\", 1, \"col-2\", 3, \"value\"], [\"updatedQty\", \"\"], [\"type\", \"button\", 1, \"btn\", \"btn-outline-warning\", 3, \"click\"], [\"class\", \"\", 4, \"ngIf\"], [1, \"\"], [1, \"item-container\"], [1, \"card\", 2, \"width\", \"18rem\"], [\"src\", \"https://cdn-icons-png.flaticon.com/512/1261/1261163.png\", \"alt\", \"Card image cap\", 1, \"card-img-top\"], [1, \"card-body\"], [1, \"card-title\"], [1, \"card-text\"], [\"id\", \"addBtn\", \"type\", \"button\", 1, \"btn\", \"btn-outline-primary\", 3, \"click\"]],\n    template: function UserComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"nav\", 0)(1, \"div\", 1)(2, \"a\", 2);\n        i0.ɵɵtext(3, \"XYZ Solutions - Grocery\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 3)(5, \"ul\", 4)(6, \"li\", 5)(7, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_7_listener() {\n          return ctx.homeBtn();\n        });\n        i0.ɵɵtext(8, \"Home\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(9, \"li\", 5)(10, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_10_listener() {\n          return ctx.showFundBtn();\n        });\n        i0.ɵɵtext(11, \"Funds\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"li\", 5)(13, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_13_listener() {\n          return ctx.showEditBtn();\n        });\n        i0.ɵɵtext(14, \"Edit Profile\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(15, \"li\", 5)(16, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_16_listener() {\n          return ctx.showCartBtn();\n        });\n        i0.ɵɵtext(17, \"Cart\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(18, \"li\", 5)(19, \"button\", 6);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_19_listener() {\n          return ctx.showOrderBtn();\n        });\n        i0.ɵɵtext(20, \"Order Status\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(21, \"a\", 2);\n        i0.ɵɵtext(22);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"button\", 7);\n        i0.ɵɵlistener(\"click\", function UserComponent_Template_button_click_23_listener() {\n          return ctx.logout_user();\n        });\n        i0.ɵɵtext(24, \"Log Out\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtemplate(25, UserComponent_div_25_Template, 29, 3, \"div\", 8);\n        i0.ɵɵtemplate(26, UserComponent_app_edit_profile_26_Template, 1, 0, \"app-edit-profile\", 9);\n        i0.ɵɵtemplate(27, UserComponent_div_27_Template, 4, 3, \"div\", 8);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(22);\n        i0.ɵɵtextInterpolate(ctx.currentUser);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.showCart);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showEdit);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.showEdit && !ctx.showCart);\n      }\n    },\n    directives: [i2.NgIf, i2.NgForOf, i4.EditProfileComponent, i5.FundsComponent, i6.OrderStatusComponent],\n    styles: [\"br[_ngcontent-%COMP%]{content:\\\"\\\\a\\\";display:contents;white-space:pre}#removeBtn[_ngcontent-%COMP%], #addBtn[_ngcontent-%COMP%]{float:right}button[_ngcontent-%COMP%]:active{transform:translateY(4px)}button[_ngcontent-%COMP%]{margin:2px}.item-container[_ngcontent-%COMP%]{position:relative;width:100vw!important;display:flex;flex-direction:row;flex-wrap:wrap}.card[_ngcontent-%COMP%]{padding:20px;margin:20px}.card[_ngcontent-%COMP%]:hover{background-color:#ffeeee3f;box-shadow:0 0 18px #1616164a;transition:box-shadow .3s ease-out}\"]\n  });\n  return UserComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}